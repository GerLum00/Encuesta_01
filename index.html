<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta de Disponibilidad</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
        }
        .question {
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Encuesta de Disponibilidad</h1>
    <form id="survey-form">
        <div id="days-container"></div>
        <button type="button" onclick="submitForm()">Enviar</button>
    </form>
    <p id="result"></p>

    <script>
        function generateAvailableDays() {
            const startDate = new Date("2024-11-26");
            const endDate = new Date("2024-12-20");
            const daysContainer = document.getElementById("days-container");
            const excludedDays = ["2024-12-06"];  // Día festivo 6 de diciembre

            let currentDate = startDate;
            while (currentDate <= endDate) {
                const dayOfWeek = currentDate.getDay(); // 2: Martes, 3: Miércoles, 4: Jueves, 5: Viernes
                const dayNumber = currentDate.getDate();
                const dateString = currentDate.toISOString().split('T')[0];

                // Excluir el 6 de diciembre y fines de semana
                if (excludedDays.indexOf(dateString) === -1 && (dayOfWeek >= 2 && dayOfWeek <= 5)) {
                    const formattedDate = currentDate.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        day: 'numeric',
                        month: 'long'
                    });

                    const dayDiv = document.createElement("div");
                    dayDiv.className = "question";
                    dayDiv.innerHTML = 
                        <label>${formattedDate}:</label><br>
                        <input type="radio" name="day${dayNumber}" value="0"> No puedo<br>
                        <input type="radio" name="day${dayNumber}" value="1"> Puedo pero no es mi preferencia<br>
                        <input type="radio" name="day${dayNumber}" value="2"> Si puedo<br>
                    ;
                    daysContainer.appendChild(dayDiv);
                }

                currentDate.setDate(currentDate.getDate() + 1);
            }
        }

    function submitForm() {
        const form = document.getElementById("survey-form");
        const formData = new FormData(form);

        // Convertir FormData a una cadena URL-encoded
        const urlEncodedData = new URLSearchParams();
        for (const [key, value] of formData.entries()) {
            urlEncodedData.append(key, value);
        }

        // URL de la API web de Google Apps Script
        const scriptURL = 'https://script.google.com/macros/s/AKfycby6oBAtr2j3e3KR-NOCH__mLNJcjPIO8wZ33yXtfYzRYXVrZfXmsqts7emJWjt1FrT0BA/exec'; // Reemplaza con tu URL de Apps Script

        fetch(scriptURL, {
            method: 'POST',
            body: urlEncodedData.toString(),
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Error en la solicitud: ' + response.statusText);
            }
            return response.json();
        })
        .then(result => {
            document.getElementById("result").innerText = "¡Gracias por enviar tu respuesta!";
        })
        .catch(error => {
            console.error('Error al enviar el formulario:', error);
            document.getElementById("result").innerText = "Hubo un error al enviar el formulario. Inténtalo de nuevo.";
        });
    }
    window.onload = generateAvailableDays;
    </script>
</body>
</html>
